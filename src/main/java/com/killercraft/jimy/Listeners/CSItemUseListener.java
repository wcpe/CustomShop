package com.killercraft.jimy.Listeners;import org.bukkit.ChatColor;import org.bukkit.entity.Player;import org.bukkit.event.EventHandler;import org.bukkit.event.Listener;import org.bukkit.event.block.Action;import org.bukkit.event.player.PlayerInteractEvent;import org.bukkit.inventory.ItemStack;import org.bukkit.inventory.meta.ItemMeta;import static com.killercraft.jimy.CustomShop.costMap;import static com.killercraft.jimy.CustomShop.langMap;import static com.killercraft.jimy.Utils.CSCostUtil.giveCost;public class CSItemUseListener implements Listener {    /**     * 当玩家右键使用物品时触发的事件处理器     *     * @param event 玩家交互事件对象     */    @EventHandler    public void onItemUse(PlayerInteractEvent event) {        Action action = event.getAction();        // 检查是否为右键点击空气或方块        if (!(action == Action.RIGHT_CLICK_AIR || action == Action.RIGHT_CLICK_BLOCK)) {            return; // 如果不是右键点击则退出方法        }        Player player = event.getPlayer();        ItemStack item = player.getItemInHand();        // 检查手中物品是否存在且具有元数据        if (item == null || !item.hasItemMeta()) {            return;        }        ItemMeta meta = item.getItemMeta();        // 检查物品的元数据是否包含 Lore        if (!meta.hasLore()) {            return;        }        String costLore = langMap.get("CostLore");        // 遍历物品的每一条 Lore        for (String lore : meta.getLore()) {            // 检查 Lore 是否包含成本信息            if (!lore.contains(costLore)) {                continue; // 如果不包含成本信息则继续下一条 Lore 的检查            }            // 剔除成本信息并获取成本数量及成本 ID            lore = lore.replace(costLore, "");            String[] loreSplit = lore.split("x");            int quantity = Integer.parseInt(ChatColor.stripColor(loreSplit[1]));            String costId = null;            // 检查成本 ID            for (String code : costMap.keySet()) {                if (lore.contains(costMap.get(code))) {                    costId = code;                    break; // 找到成本 ID 则结束循环                }            }            // 如果存在成本 ID 则执行给予成本的操作            if (costId != null) {                player.sendMessage(giveCost(player.getName(), costId, quantity));            }            // 减少手中物品数量            int amount = item.getAmount();            if (amount > 1) {                item.setAmount(amount - 1);                player.setItemInHand(item);            } else {                player.setItemInHand(null);            }            // 成本处理完成，退出循环            break;        }    }}